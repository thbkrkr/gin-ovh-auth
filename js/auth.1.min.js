(function(){AUTH_LOGIN_ELEM_ID="login";AUTH_LOGOUT_ELEM_ID="logout";AUTH_CREDS_URL="/auth/credential";AUTH_VALIDATION_URL="/auth/validate/";AUTH_LOCAL_STORAGE_KEY="auth";DEFAULT_AUTH_HOME_PATH="/s/";DEFAULT_AUTH_LOGIN_PATH="/s/login.html";DEFAULT_AUTH_HEADER="X-Auth";"undefined"===typeof AUTH_HOME_PATH&&(AUTH_HOME_PATH=DEFAULT_AUTH_HOME_PATH);"undefined"===typeof AUTH_LOGIN_PATH&&(AUTH_LOGIN_PATH=DEFAULT_AUTH_LOGIN_PATH);"undefined"===typeof AUTH_HEADER&&(AUTH_HEADER=DEFAULT_AUTH_HEADER);window.addEventListener("load",
function(){(loginElem=document.getElementById(AUTH_LOGIN_ELEM_ID))&&loginElem.addEventListener("click",function(){loginElem.innerHTML="...";$get(AUTH_CREDS_URL,function(a){window.location=a.url})});localStorage.getItem(AUTH_LOCAL_STORAGE_KEY)?window.location.pathname!=AUTH_HOME_PATH&&(window.location.pathname=AUTH_HOME_PATH):$(".container").show();(token=$param("token"))&&$get(AUTH_VALIDATION_URL+token,function(a){localStorage.setItem(AUTH_LOCAL_STORAGE_KEY,a.auth);window.location=AUTH_HOME_PATH});
(logoutElem=document.getElementById(AUTH_LOGOUT_ELEM_ID))&&logoutElem.addEventListener("click",function(){$logout()})});this.$logout=function(){window.location=AUTH_LOGIN_PATH;localStorage.removeItem(AUTH_LOCAL_STORAGE_KEY)};this.$param=function(a){var b=window.location.href;a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};this.$get=function(a,b,c,d){return $ajax(a,void 0,b,c,d)};this.$post=function(a,
b,c,d,f){return $ajax(a,b,c,d,f)};this.$ajax=function(a,b,c,d,f){var e={},g=localStorage.getItem(AUTH_LOCAL_STORAGE_KEY);g&&(e[AUTH_HEADER]=g);type="GET";b&&(type="POST");req={type:type,url:a,contentType:"application/json",headers:e,success:function(a){"object"===typeof a?c(a):c(JSON.parse(a))},error:function(b,c,e){401!==b.status||f||$logout();d?d(e):console.error("error on "+a+" status="+b.status)}};b&&(req.data=JSON.stringify(b));$.ajax(req)}})();
